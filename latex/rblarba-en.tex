%
% Niniejszy plik stanowi przykład formatowania pracy magisterskiej na
% Wydziale MIM UW.  Szkielet użytych poleceń można wykorzystywać do
% woli, np. formatujac wlasna prace.
%
% Zawartosc merytoryczna stanowi oryginalnosiagniecie
% naukowosciowe Marcina Wolinskiego.  Wszelkie prawa zastrzeżone.
%
% Copyright (c) 2001 by Marcin Woliński <M.Wolinski@gust.org.pl>
% Poprawki spowodowane zmianami przepisów - Marcin Szczuka, 1.10.2004
% Poprawki spowodowane zmianami przepisow i ujednolicenie 
% - Seweryn Karłowicz, 05.05.2006
% Dodanie wielu autorów i tłumaczenia na angielski - Kuba Pochrybniak, 29.11.2016

% dodaj opcję [licencjacka] dla pracy licencjackiej
% dodaj opcję [en] dla wersji angielskiej (mogą być obie: [licencjacka,en])
\documentclass[en]{pracamgr}

% Dane magistranta:
\autor{Tomasz Kępa}{359746}

% Dane magistrantów:
%\autor{Autor Zerowy}{342007}
%\autori{Autor Pierwszy}{342013}
%\autorii{Drugi Autor-Z-Rzędu}{231023}
%\autoriii{Trzeci z Autorów}{777321}
%\autoriv{Autor nr Cztery}{432145}
%\autorv{Autor nr Pięć}{342011}

\title{Detecting Anti-Adblockers using Differential Execution Analysis}
\titlepl{Wykrywanie skryptów blokujących rozszerzenia typu AdBlock w przeglądarkach}

%\tytulang{An implementation of a difference blabalizer based on the theory of $\sigma$ -- $\rho$ phetors}

%kierunek: 
% - matematyka, informacyka, ...
% - Mathematics, Computer Science, ...
\kierunek{Computer Science}

% informatyka - nie okreslamy zakresu (opcja zakomentowana)
% matematyka - zakres moze pozostac nieokreslony,
% a jesli ma byc okreslony dla pracy mgr,
% to przyjmuje jedna z wartosci:
% {metod matematycznych w finansach}
% {metod matematycznych w ubezpieczeniach}
% {matematyki stosowanej}
% {nauczania matematyki}
% Dla pracy licencjackiej mamy natomiast
% mozliwosc wpisania takiej wartosci zakresu:
% {Jednoczesnych Studiow Ekonomiczno--Matematycznych}

% \zakres{Tu wpisac, jesli trzeba, jedna z opcji podanych wyzej}

% Praca wykonana pod kierunkiem:
% (podać tytuł/stopień imię i nazwisko opiekuna
% Instytut
% ew. Wydział ew. Uczelnia (jeżeli nie MIM UW))
\opiekun{dr Konrad Durnoga\\
 Institute of Informatics
  }

% miesiąc i~rok:
\date{August 2019}

%Podać dziedzinę wg klasyfikacji Socrates-Erasmus:
\dziedzina{ 
%11.0 Matematyka, Informatyka:\\ 
%11.1 Matematyka\\ 
11.3 Informatics, Computer Science
%11.3 Informatyka\\ 
%11.4 Sztuczna inteligencja\\ 
%11.5 Nauki aktuarialne\\
%11.9 Inne nauki matematyczne i informatyczne
}

%Klasyfikacja tematyczna wedlug AMS (matematyka) lub ACM (informatyka)
\klasyfikacja{Software and its engineering.~Dynamic analysis}

% Słowa kluczowe:
\keywords{dynamic analysis, differential execution analysis, javascript, anti-adblockers, ads}

% Tu jest dobre miejsce na Twoje własne makra i~środowiska:
\newtheorem{defi}{Definicja}[section]

\usepackage{xcolor}
\newcommand{\todo}[1]{\colorbox{yellow}{ \color{red} \textbf{TODO}: {#1}}}
\usepackage{cite}
\usepackage{url}
\usepackage{hyperref}
\hypersetup{
  colorlinks   = true,    % Colours links instead of ugly boxes
  urlcolor     = blue,    % Colour for external hyperlinks
  linkcolor    = blue,    % Colour of internal links
  citecolor    = red      % Colour of citations
}

% koniec definicji

\begin{document}
\maketitle

%tu idzie streszczenie na strone poczatkowa
\begin{abstract}
Ads are the main source of income of numerous websites. 
However, some of them are fairly annoying which causes many users to use adblocking browser extensions. 
Some services, in turn, use specialized scripts to detect such plug-ins 
and silently report them or block some content as a punishment. 
The goal of this thesis is to build a pipeline for detecting such scripts based on a differential execution analysis, 
a method provided by other authors in 2018. 
Such a mechanism can be used later to analyze the prevalence of anti-adblockers 
on Polish websites or to build an extension capable of circumventing such scripts.

\end{abstract}

\tableofcontents
%\listoffigures
%\listoftables

\chapter*{Introduction}
\addcontentsline{toc}{chapter}{Introduction}

In modern-era Internet most webpages operate for profit. Most of them, however, choose to provide free content
in exchange for displaying paid ads. Unfortunately, not all websites play fair. Some of them
concentrate on displaying as many ads as possible and generate traffic by using click-baits 
and other shady practices. Even websites with valuable content can have overwhelming amount 
of ads. This leads to grave dissatisfaction of some portion of users. To make their browsing experience better,
they turn to use of ad-blocking extensions.

The amount of users doing that cannot be ignored. In 2019 there was over 615 million devices worldwide
with adblocker installed \cite{internet-facts}. This, in turn, leads to loss of revenue for many businesses.
To combat this, some of them choose to deploy anti-adblockers, which generate warnings 
or even block content entirely for users with adblockers.


\include{basic_concepts}


\chapter{Trace collection}

\section{Methods overview}
There are a few distinct ways to obtain execution trace of JavaScript code. 

The simplest (and most limited) methods use only mechanisms present in the language.
More elaborate inject special tracing code to analyzed script. The last kind modify the engine to produce
the desired data.

\section{Dynamic in-JS code injection}
JavaScript is a very dynamic language. For this reason it is relatively easy to write code that will
modify each function present in the environment to log each entry and exit,
possibly along with all the arguments and return value \cite{stack:js-console-log}.

Snippet \todo{add snippet showing how to do that} is an example of a code that does just that.
It replaces function definition with new one that logs its arguments before calling the old function and logs return
the return value after that. 

It is also possible to traverse recursively the entire global object and replace each function this way.

However, this is not enough for the needs of Differential Execution Analysis. 
The most obvious limitation is that it's not possible to instrument control statements.
Another major shortcoming is that function can be instrumented only after they are defined. 
It is quite an obstacle, because JavaScript allows to define function practically anywhere and it is very common
to use anonymous functions as callbacks. It is not possible to instrument such callback 
without modyfing the instumented code, which brings us to the next method

\section{Static code injection}
Less limited approach is to statically rewrite the instrumented code and inject tracing code wherever it is needed.


\section{Engine instrumentation}

\chapter{Trace collection by V8 instrumentation}
\section{V8 architecture}
\subsection{JS built-in functions}
\section{V8 usage in chromium}
\label{v8-in-chrome}

\subsection{Extensions model}
\section{Chrome's extensions architecture}
\section{V8's \emph{-{}-trace} flag}
\section{Bytecode injection}
\section{Controlling Chrome programatically}

\chapter{Trace analysis}
\section{Trace untangling using execution index}
\subsection{Optimizations}

\section{Trace alignment}
\label{trace-alignment}

\section{Trace matching using SMP}
\section{Noise filtering}

\chapter{Evaluation}
\section{Evaluated websites}
\section{Detected anti-adblockers}


\bibliography{sources}{}
\addcontentsline{toc}{chapter}{Bibliography}
\bibliographystyle{plain}

\end{document}


%%% Local Variables:
%%% mode: latex
%%% TeX-master: t
%%% coding: latin-2
%%% End:
